{% extends "base.html" %}

{% block title %}Orders List{% endblock %}

{% block content %}
<div class="max-w-7xl mx-auto">
    <div class="bg-white rounded-lg shadow p-6">
        <div class="flex justify-between items-center mb-6">
            <h2 class="text-2xl font-bold text-gray-800">ðŸ“‹ Orders List</h2>
            <div class="flex gap-2">
                <span class="px-3 py-1 bg-orange-100 text-orange-800 rounded">Total: {{ total_orders }}</span>
            </div>
        </div>

        <!-- Filters -->
        <div class="grid grid-cols-1 md:grid-cols-4 gap-4 mb-6">
            <div>
                <label class="block text-sm font-medium text-gray-700 mb-1">Order Type</label>
                <select id="filterType" class="w-full border border-gray-300 rounded px-3 py-2">
                    <option value="">All Types</option>
                    <option value="cod">COD Orders</option>
                    <option value="abandoned_cart">Abandoned Cart</option>
                </select>
            </div>
            <div>
                <label class="block text-sm font-medium text-gray-700 mb-1">Store</label>
                <select id="filterStore" class="w-full border border-gray-300 rounded px-3 py-2">
                    <option value="">All Stores</option>
                    {% for store in stores %}
                    <option value="{{ store.id }}">{{ store.name }}</option>
                    {% endfor %}
                </select>
            </div>
            <div>
                <label class="block text-sm font-medium text-gray-700 mb-1">Status</label>
                <select id="filterStatus" class="w-full border border-gray-300 rounded px-3 py-2">
                    <option value="">All Statuses</option>
                    <option value="pending">Pending</option>
                    <option value="assigned">Assigned</option>
                    <option value="confirmed">Confirmed</option>
                    <option value="cancelled">Cancelled</option>
                </select>
            </div>
            <div class="flex items-end">
                <button onclick="applyFilters()" class="w-full bg-blue-500 text-white px-4 py-2 rounded hover:bg-blue-600">
                    Apply Filters
                </button>
            </div>
        </div>

        <!-- Orders Table -->
        <div class="overflow-x-auto">
            <table class="min-w-full divide-y divide-gray-200">
                <thead class="bg-gray-50">
                    <tr>
                        <th class="px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase">Order ID</th>
                        <th class="px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase">Type</th>
                        <th class="px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase">Store</th>
                        <th class="px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase">Customer</th>
                        <th class="px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase">Phone</th>
                        <th class="px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase">Product</th>
                        <th class="px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase">Price</th>
                        <th class="px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase">Status</th>
                        <th class="px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase">Assigned To</th>
                    </tr>
                </thead>
                <tbody class="bg-white divide-y divide-gray-200" id="ordersTable">
                    {% for order in orders %}
                    <tr class="hover:bg-gray-50">
                        <td class="px-4 py-3 text-sm">{{ order.order_id }}</td>
                        <td class="px-4 py-3 text-sm">
                            {% if order.order_type == 'cod' %}
                            <span class="px-2 py-1 bg-green-100 text-green-800 rounded text-xs">COD</span>
                            {% else %}
                            <span class="px-2 py-1 bg-purple-100 text-purple-800 rounded text-xs">Abandoned Cart</span>
                            {% endif %}
                        </td>
                        <td class="px-4 py-3 text-sm">{{ order.store_name }}</td>
                        <td class="px-4 py-3 text-sm">{{ order.customer_name }}</td>
                        <td class="px-4 py-3 text-sm font-mono">{{ order.phone }}</td>
                        <td class="px-4 py-3 text-sm">{{ order.product_name[:30] }}{% if order.product_name|length > 30 %}...{% endif %}</td>
                        <td class="px-4 py-3 text-sm">â‚¹{{ "%.2f"|format(order.price) }}</td>
                        <td class="px-4 py-3 text-sm">
                            {% if order.status == 'pending' %}
                            <span class="px-2 py-1 bg-yellow-100 text-yellow-800 rounded text-xs">Pending</span>
                            {% elif order.status == 'assigned' %}
                            <span class="px-2 py-1 bg-blue-100 text-blue-800 rounded text-xs">Assigned</span>
                            {% elif order.status == 'confirmed' %}
                            <span class="px-2 py-1 bg-green-100 text-green-800 rounded text-xs">Confirmed</span>
                            {% elif order.status == 'cancelled' %}
                            <span class="px-2 py-1 bg-red-100 text-red-800 rounded text-xs">Cancelled</span>
                            {% endif %}
                        </td>
                        <td class="px-4 py-3 text-sm">{{ order.caller_name or '-' }}</td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>

        {% if not orders %}
        <div class="text-center py-8 text-gray-500">
            No orders found. Try fetching orders from Shopify.
        </div>
        {% endif %}
    </div>
</div>

<script>
function applyFilters() {
    const type = document.getElementById('filterType').value;
    const store = document.getElementById('filterStore').value;
    const status = document.getElementById('filterStatus').value;
    
    const params = new URLSearchParams();
    if (type) params.append('type', type);
    if (store) params.append('store', store);
    if (status) params.append('status', status);
    
    window.location.href = '/orders-list?' + params.toString();
}
</script>
{% endblock %}
